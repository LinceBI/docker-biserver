-- DROP DATABASE IF EXISTS "<%= ENV['COCKROACH_AUDIT_DATABASE'] %>";
-- DROP USER IF EXISTS "<%= ENV['COCKROACH_AUDIT_USER'] %>";

CREATE USER IF NOT EXISTS "<%= ENV['COCKROACH_AUDIT_USER'] %>" WITH PASSWORD '<%= ENV['COCKROACH_AUDIT_PASSWORD'] %>';
CREATE DATABASE IF NOT EXISTS "<%= ENV['COCKROACH_AUDIT_DATABASE'] %>" WITH ENCODING = 'UTF8';
GRANT ALL PRIVILEGES ON DATABASE "<%= ENV['COCKROACH_AUDIT_DATABASE'] %>" TO "<%= ENV['COCKROACH_AUDIT_USER'] %>";

\connect "<%= ENV['COCKROACH_AUDIT_DATABASE'] %>"

BEGIN;

CREATE TABLE AUDIT (
	JOB_ID VARCHAR(200) NULL,
	INST_ID VARCHAR(200) NULL,
	OBJ_ID VARCHAR(200) NULL,
	OBJ_TYPE VARCHAR(200) NULL,
	ACTOR VARCHAR(200) NULL,
	MESSAGE_TYPE VARCHAR(200) NULL,
	MESSAGE_NAME VARCHAR(200) NULL,
	MESSAGE_TEXT_VALUE VARCHAR(1024) NULL,
	MESSAGE_NUM_VALUE NUMERIC(19,2) NULL,
	DURATION NUMERIC(19,2) NULL,
	AUDIT_TIME TIMESTAMP NULL
);

ALTER TABLE AUDIT OWNER TO "<%= ENV['COCKROACH_AUDIT_USER'] %>";

COMMIT;
