-- DROP DATABASE IF EXISTS `<%= ENV['MYSQL_AUDIT_DATABASE'] %>`;
-- DROP USER IF EXISTS `<%= ENV['MYSQL_AUDIT_USER'] %>`;

CREATE USER IF NOT EXISTS `<%= ENV['MYSQL_AUDIT_USER'] %>`@`%` IDENTIFIED BY '<%= ENV['MYSQL_AUDIT_PASSWORD'] %>';
CREATE DATABASE IF NOT EXISTS `<%= ENV['MYSQL_AUDIT_DATABASE'] %>` DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci;
GRANT ALL ON `<%= ENV['MYSQL_AUDIT_DATABASE'] %>`.* TO `<%= ENV['MYSQL_AUDIT_USER'] %>`@`%`;

USE `<%= ENV['MYSQL_AUDIT_DATABASE'] %>`;

CREATE TABLE IF NOT EXISTS AUDIT (
	JOB_ID VARCHAR(200) NULL,
	INST_ID VARCHAR(200) NULL,
	OBJ_ID VARCHAR(200) NULL,
	OBJ_TYPE VARCHAR(200) NULL,
	ACTOR VARCHAR(200) NULL,
	MESSAGE_TYPE VARCHAR(200) NULL,
	MESSAGE_NAME VARCHAR(200) NULL,
	MESSAGE_TEXT_VALUE VARCHAR(1024) NULL,
	MESSAGE_NUM_VALUE NUMERIC(19,2) NULL,
	DURATION NUMERIC(19,2) NULL,
	AUDIT_TIME TIMESTAMP NULL
);

COMMIT;
