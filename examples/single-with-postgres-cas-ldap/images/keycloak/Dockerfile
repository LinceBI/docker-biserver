ARG KEYCLOAK_VERSION=22.0.3

FROM quay.io/keycloak/keycloak:${KEYCLOAK_VERSION}
ARG KEYCLOAK_VERSION

ARG KC_DB
ENV KC_DB=${KC_DB}
ARG KC_HTTP_ENABLED
ENV KC_HTTP_ENABLED=${KC_HTTP_ENABLED}
ARG KC_HTTP_HOST
ENV KC_HTTP_HOST=${KC_HTTP_HOST}
ARG KC_HTTP_PORT
ENV KC_HTTP_PORT=${KC_HTTP_PORT}
ARG KC_HTTP_RELATIVE_PATH
ENV KC_HTTP_RELATIVE_PATH=${KC_HTTP_RELATIVE_PATH}
ARG KC_HOSTNAME_STRICT
ENV KC_HOSTNAME_STRICT=${KC_HOSTNAME_STRICT}
ARG KC_HOSTNAME_STRICT_HTTPS
ENV KC_HOSTNAME_STRICT_HTTPS=${KC_HOSTNAME_STRICT_HTTPS}
ARG KC_PROXY
ENV KC_PROXY=${KC_PROXY}

ADD --chown=keycloak:root https://github.com/jacekkow/keycloak-protocol-cas/releases/download/${KEYCLOAK_VERSION}/keycloak-protocol-cas-${KEYCLOAK_VERSION}.jar /opt/keycloak/providers/

WORKDIR /opt/keycloak/
RUN /opt/keycloak/bin/kc.sh build

ENTRYPOINT ["/opt/keycloak/bin/kc.sh"]
